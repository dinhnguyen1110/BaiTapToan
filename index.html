<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathMaster 10 - Luyện Toán Thông Minh</title>

    <!-- Tailwind CSS (Play CDN for standalone usage) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        glass: "rgba(255, 255, 255, 0.7)",
                        glassBorder: "rgba(255, 255, 255, 0.4)",
                        primary: "#6366f1", // Indigo 500
                        secondary: "#a855f7", // Purple 500
                        accent: "#f43f5e", // Rose 500
                    },
                    fontFamily: {
                        sans: ['"Outfit"', 'sans-serif'],
                        display: ['"Clash Display"', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        },
                        pop: {
                            '0%': { transform: 'scale(0.8)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- CSS Giấy Khen -->
    <style>
        .cert-preview-container {
            width: 100%;
            overflow: hidden;
            padding: 10px;
            display: flex;
            justify-content: center;
            /* Height will be set by JS based on scaled certificate */
        }

        .cert-preview-container {
            width: 100%;
            overflow: hidden;
            padding: 10px;
            display: flex;
            justify-content: center;
        }

        /* SCOPED CERTIFICATE STYLES FROM MauGiayKhen.html */
        .certificate-container {
            width: 297mm;
            height: 210mm;
            background-color: #fffdf0;
            position: relative;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            padding: 15px;
            box-sizing: border-box;

            /* Font & Reset defaults */
            font-family: 'Noto Serif', serif;
            color: #333;
            text-align: center;
            /* inherited from body in source */
            line-height: normal !important;
            /* Force reset */

            /* Scaling props */
            transform-origin: top center;
            flex-shrink: 0;
        }

        .certificate-container .border-outer {
            width: 100%;
            height: 100%;
            border: 5px solid #b8860b;
            padding: 5px;
            box-sizing: border-box;
            position: relative;
        }

        .certificate-container .border-inner {
            width: 100%;
            height: 100%;
            border: 2px solid #daa520;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-image: radial-gradient(#d4af37 1px, transparent 1px);
            background-size: 30px 30px;
            padding: 20px 40px;
            box-sizing: border-box;
        }

        .certificate-container .corner {
            position: absolute;
            width: 80px;
            height: 80px;
            border: 5px double #b8860b;
            box-sizing: border-box;
        }

        .certificate-container .top-left {
            top: 10px;
            left: 10px;
            border-right: none;
            border-bottom: none;
        }

        .certificate-container .top-right {
            top: 10px;
            right: 10px;
            border-left: none;
            border-bottom: none;
        }

        .certificate-container .bottom-left {
            bottom: 10px;
            left: 10px;
            border-right: none;
            border-top: none;
        }

        .certificate-container .bottom-right {
            bottom: 10px;
            right: 10px;
            border-left: none;
            border-top: none;
        }

        .certificate-container .corner::after {
            content: '';
            position: absolute;
            width: 60%;
            height: 60%;
            border: 2px solid #daa520;
        }

        .certificate-container .top-left::after {
            top: 5px;
            left: 5px;
            border-right: none;
            border-bottom: none;
        }

        .certificate-container .top-right::after {
            top: 5px;
            right: 5px;
            border-left: none;
            border-bottom: none;
        }

        .certificate-container .bottom-left::after {
            bottom: 5px;
            left: 5px;
            border-right: none;
            border-top: none;
        }

        .certificate-container .bottom-right::after {
            bottom: 5px;
            right: 5px;
            border-left: none;
            border-top: none;
        }

        .certificate-container .header-text {
            text-align: center;
            margin-top: 20px;
            color: #333;
        }

        .certificate-container .nation {
            text-transform: uppercase;
            font-weight: bold;
            font-size: 16pt;
            margin-bottom: 5px;
        }

        .certificate-container .motto {
            font-weight: bold;
            font-size: 14pt;
            position: relative;
            display: inline-block;
        }

        .certificate-container .motto::after {
            content: '';
            display: block;
            width: 60%;
            height: 2px;
            background: #333;
            margin: 5px auto 0;
        }

        .certificate-container .logo-placeholder {
            margin-top: 15px;
            color: #daa520;
            font-size: 24px;
        }

        .certificate-container h1.title {
            font-family: 'Playfair Display', serif;
            color: #cc0000;
            font-size: 52pt;
            margin: 10px 0 5px 0;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
            letter-spacing: 5px;
            text-transform: uppercase;
        }

        .certificate-container .subtitle {
            font-size: 14pt;
            margin-bottom: 10px;
            font-style: italic;
            color: #555;
        }

        .certificate-container .content-body {
            width: 100%;
            text-align: center;
            flex-grow: 1;
        }

        .certificate-container .recipient-name {
            font-family: 'Pinyon Script', cursive;
            font-size: 50pt;
            color: #b8860b;
            margin: 0px 0 0px 0;
            line-height: normal;
            /* Force normal */
            min-height: 70px;
            outline: none;
            cursor: text;
        }

        .certificate-container .recipient-class {
            font-size: 16pt;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .certificate-container .award-for {
            font-size: 14pt;
            font-weight: normal;
            margin-bottom: 5px;
            font-style: italic;
        }

        .certificate-container .award-reason {
            font-family: 'Roboto Slab', serif;
            font-size: 20pt;
            color: #cc0000;
            font-weight: bold;
            width: 90%;
            margin: 0 auto;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 5px;
            outline: none;
            cursor: text;
        }

        .certificate-container .footer {
            width: 100%;
            display: flex;
            justify-content: flex-end;
            margin-top: 30px;
            margin-bottom: 40px;
            padding: 0 80px;
            box-sizing: border-box;
        }

        .certificate-container .footer-right {
            text-align: center;
            width: 300px;
        }

        .certificate-container .date-line {
            font-style: italic;
            font-size: 13pt;
            margin-bottom: 15px;
            outline: none;
        }

        .certificate-container .signer-title {
            font-size: 14pt;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .certificate-container .signature-hand {
            font-family: 'Great Vibes', cursive;
            font-size: 40pt;
            color: #000080;
            margin: 10px 0;
            transform: rotate(-5deg);
        }

        .certificate-container .signer-name {
            font-size: 15pt;
            font-weight: bold;
            outline: none;
        }

        .certificate-container .stamp-placeholder {
            position: absolute;
            width: 110px;
            height: 110px;
            border: 3px solid rgba(204, 0, 0, 0.6);
            border-radius: 50%;
            right: 210px;
            bottom: 90px;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(204, 0, 0, 0.6);
            font-weight: bold;
            font-size: 14px;
            transform: rotate(-15deg);
            opacity: 0.4;
            z-index: 1;
        }

        .certificate-container .badge-left {
            position: absolute;
            bottom: 50px;
            left: 80px;
            width: 130px;
            height: 130px;
            z-index: 10;
            transform: rotate(-20deg);
        }
    </style>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://api.fontshare.com/v2/css?f[]=clash-display@600,700&display=swap" rel="stylesheet">
    <!-- Fonts cho Giấy Khen -->
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto+Slab:wght@300;400;700&family=Pinyon+Script&family=Noto+Serif:ital,wght@0,400;0,700;1,400&family=Great+Vibes&display=swap"
        rel="stylesheet">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- html2canvas for certificate download -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: { fontCache: 'global' },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    console.log('MathJax is loaded');
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Upmath Loader for dynamic TikZ rendering -->
    <script src="js/utils/upmath-loader.js"></script>

    <!-- html2canvas for certificate image generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>





    <!-- Firebase (Compat SDKs for Standalone File) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%);
            background-attachment: fixed;
            min-height: 100vh;
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        .glass-btn {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.2s ease;
        }

        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .hidden-accessible {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>

<body class="text-slate-800 overflow-x-hidden selection:bg-indigo-200 selection:text-indigo-900">

    <!-- Background Elements -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div
            class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-purple-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float">
        </div>
        <div class="absolute top-[20%] right-[-10%] w-[400px] h-[400px] bg-indigo-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float"
            style="animation-delay: 2s"></div>
        <div class="absolute bottom-[-10%] left-[20%] w-[600px] h-[600px] bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float"
            style="animation-delay: 4s"></div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 px-4 py-3">
        <div class="max-w-6xl mx-auto glass-panel rounded-2xl px-4 py-2 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer" onclick="app.goHome()">
                <div
                    class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-indigo-200">
                    <i class="fa-solid fa-shapes"></i>
                </div>
                <div>
                    <h1 class="font-display font-bold text-lg leading-none tracking-tight">MathMaster</h1>
                    <span class="text-[10px] text-slate-500 font-semibold uppercase tracking-wider">Luyện Thi Lớp
                        10</span>
                </div>
            </div>

            <div class="flex items-center gap-3">
                <!-- User Info (Hidden initially) -->
                <div id="user-display" class="hidden md:flex flex-col items-end mr-2">
                    <span id="user-name-display" class="text-sm font-bold text-slate-700">Student</span>
                    <span class="text-[10px] text-slate-400">Học viên</span>
                </div>

                <button onclick="app.openProfile()"
                    class="glass-btn w-9 h-9 rounded-full flex items-center justify-center text-rose-500 relative"
                    title="Hồ sơ & Thống kê">
                    <i class="fa-solid fa-fire"></i>
                    <span id="streak-badge"
                        class="absolute -top-1 -right-1 bg-red-600 text-white text-[9px] font-bold w-4 h-4 rounded-full flex items-center justify-center hidden">0</span>
                </button>
                <button onclick="app.openLeaderboard()"
                    class="glass-btn w-9 h-9 rounded-full flex items-center justify-center text-amber-500"
                    title="Bảng xếp hạng">
                    <i class="fa-solid fa-trophy"></i>
                </button>
                <button onclick="app.openSettings()"
                    class="glass-btn w-9 h-9 rounded-full flex items-center justify-center text-slate-500 hover:text-indigo-600 transition-colors"
                    title="Cài đặt">
                    <i class="fa-solid fa-gear"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <main class="w-full min-h-screen pt-24 pb-10 px-4 flex flex-col items-center justify-center">

        <!-- 1. WELCOME SCREEN -->
        <section id="screen-welcome"
            class="w-full max-w-md glass-panel rounded-3xl p-8 text-center animate-pop relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500">
            </div>

            <div
                class="w-24 h-24 bg-indigo-50 rounded-full mx-auto mb-6 flex items-center justify-center text-indigo-600 text-4xl shadow-inner">
                <i class="fa-solid fa-graduation-cap"></i>
            </div>

            <h2 class="font-display text-3xl font-bold mb-2 text-slate-800">Xin chào!</h2>
            <p class="text-slate-500 mb-8 leading-relaxed">Hãy nhập tên của bạn để bắt đầu hành trình chinh phục Toán 10
                cùng AI.</p>

            <form onsubmit="app.handleLogin(event)" class="space-y-4">
                <div class="text-left">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-widest ml-1">Họ và Tên</label>
                    <input type="text" id="username-input"
                        class="w-full mt-1 px-4 py-3 rounded-xl border border-slate-200 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-100 outline-none transition-all bg-white/50 backdrop-blur-sm"
                        placeholder="Ví dụ: Minh Khôi" required>
                </div>

                <button type="submit"
                    class="w-full py-3.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-bold shadow-lg shadow-indigo-200 hover:shadow-xl hover:scale-[1.02] transition-all transform active:scale-95">
                    Bắt đầu ngay <i class="fa-solid fa-arrow-right ml-2"></i>
                </button>
            </form>
        </section>

        <!-- 2. DASHBOARD SCREEN (Topic Selection) -->
        <section id="screen-dashboard" class="hidden w-full max-w-5xl animate-pop">
            <div class="text-center mb-10">
                <h2 class="font-display text-4xl font-bold text-slate-800 mb-3">Chọn chủ đề luyện tập</h2>
                <div class="h-1 w-20 bg-indigo-500 mx-auto rounded-full"></div>
            </div>

            <div id="topic-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Topics injected here -->
            </div>
        </section>

        <!-- 3. QUIZ SCREEN -->
        <section id="screen-quiz" class="hidden w-full max-w-4xl h-[80vh] flex flex-col">
            <!-- Header Info -->
            <div class="flex justify-between items-end mb-4 px-2">
                <div>
                    <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Tiến độ</span>
                    <div class="text-2xl font-display font-bold text-slate-800">
                        <span id="q-current">01</span><span class="text-slate-300 text-lg">/</span><span id="q-total"
                            class="text-slate-400 text-lg">10</span>
                    </div>
                </div>
                <div class="text-right">
                    <span class="text-xs font-bold text-slate-400 uppercase tracking-widest">Điểm số</span>
                    <div class="text-2xl font-display font-bold text-indigo-600" id="score-live">0</div>
                </div>
            </div>

            <!-- Quiz Card -->
            <div
                class="flex-grow glass-panel rounded-3xl overflow-hidden flex flex-col relative shadow-2xl shadow-indigo-100/50">
                <!-- Progress Bar -->
                <div class="w-full h-1.5 bg-slate-100">
                    <div id="progress-fill"
                        class="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-500 ease-out"
                        style="width: 0%"></div>
                </div>

                <!-- Scrollable Content -->
                <div class="flex-grow p-6 md:p-10 overflow-y-auto">
                    <!-- AI Tag -->
                    <div id="ai-badge"
                        class="hidden inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-fuchsia-100 text-fuchsia-600 text-xs font-bold mb-4 border border-fuchsia-200">
                        <i class="fa-solid fa-wand-magic-sparkles"></i> AI Generated
                    </div>

                    <!-- Question -->
                    <div id="question-content"
                        class="text-xl md:text-2xl font-semibold text-slate-800 mb-8 leading-relaxed">
                        <!-- LaTeX Question Content -->
                    </div>

                    <!-- Hint & AI Buttons -->
                    <div class="flex justify-end gap-2 mb-4">
                        <button id="btn-tutor" onclick="app.openTutor()"
                            class="text-xs md:text-sm font-bold text-fuchsia-500 hover:text-fuchsia-600 flex items-center gap-1 transition-colors px-3 py-1.5 rounded-lg hover:bg-fuchsia-50 border border-transparent hover:border-fuchsia-200">
                            <i class="fa-solid fa-robot"></i> Hỏi gia sư AI
                        </button>
                        <button id="btn-hint" onclick="quiz.toggleHint()"
                            class="text-xs md:text-sm font-bold text-amber-500 hover:text-amber-600 flex items-center gap-1 transition-colors px-3 py-1.5 rounded-lg hover:bg-amber-50">
                            <i class="fa-regular fa-lightbulb"></i> Gợi ý
                        </button>
                    </div>

                    <!-- Hint Box -->
                    <div id="box-hint"
                        class="hidden mb-6 bg-amber-50 border border-amber-200 rounded-xl p-4 text-amber-800 text-sm animate-pop">
                        <strong class="block mb-1 text-amber-600 uppercase text-xs tracking-wider">Gợi ý:</strong>
                        <div id="hint-content"></div>
                    </div>

                    <!-- Options Grid -->
                    <div id="options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Options injected -->
                    </div>

                    <!-- Feedback Area (Rationale) -->
                    <div id="feedback-area" class="hidden mt-8 animate-pop">
                        <!-- Injected via JS -->
                    </div>
                </div>

                <!-- Footer Nav -->
                <div
                    class="p-4 md:p-6 border-t border-slate-100 bg-white/50 backdrop-blur-sm flex justify-between items-center z-10">
                    <button onclick="app.goHome()"
                        class="text-slate-400 hover:text-slate-600 text-sm font-medium transition-colors">
                        <i class="fa-solid fa-xmark mr-1"></i> Thoát
                    </button>
                    <button id="btn-next" onclick="quiz.next()"
                        class="hidden px-8 py-3 bg-slate-800 hover:bg-slate-900 text-white rounded-xl font-bold shadow-lg transition-all transform hover:scale-105 active:scale-95 flex items-center">
                        Tiếp theo <i class="fa-solid fa-arrow-right ml-2"></i>
                    </button>
                </div>

                <!-- Anti-guessing warning toast -->
                <div id="toast-warning"
                    class="hidden absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-rose-500 text-white px-6 py-3 rounded-xl shadow-xl z-50 font-bold whitespace-nowrap animate-shake">
                    <i class="fa-solid fa-stopwatch mr-2"></i> Hãy suy nghĩ kỹ hơn!
                </div>
            </div>
        </section>

        <!-- 4. COMPLETION SCREEN -->
        <section id="screen-completion"
            class="hidden w-full max-w-lg glass-panel rounded-3xl p-8 text-center animate-pop">
            <div class="relative inline-block mb-6">
                <div class="absolute inset-0 bg-yellow-200 rounded-full blur-xl opacity-50"></div>
                <div
                    class="relative w-24 h-24 bg-gradient-to-br from-yellow-300 to-yellow-500 rounded-full flex items-center justify-center text-white text-5xl shadow-xl">
                    <i class="fa-solid fa-trophy"></i>
                </div>
            </div>

            <h2 class="font-display text-3xl font-bold text-slate-800 mb-2">Hoàn thành!</h2>
            <div class="text-slate-500 mb-8">Bạn đã hoàn thành bài luyện tập.</div>

            <div class="grid grid-cols-2 gap-4 mb-8">
                <div class="bg-indigo-50 rounded-2xl p-4 border border-indigo-100">
                    <div class="text-xs font-bold text-indigo-400 uppercase tracking-widest mb-1">Điểm số</div>
                    <div class="text-3xl font-bold text-indigo-600"><span id="final-score">0</span><span
                            class="text-lg text-indigo-300">/</span><span id="final-total">10</span></div>
                </div>
                <div class="bg-emerald-50 rounded-2xl p-4 border border-emerald-100">
                    <div class="text-xs font-bold text-emerald-400 uppercase tracking-widest mb-1">Độ chính xác</div>
                    <div class="text-3xl font-bold text-emerald-600" id="final-percent">0%</div>
                </div>
            </div>

            <div class="flex flex-col gap-3">
                <div class="flex flex-col gap-3">
                    <!-- Certificate Area (HTML-based, not image) -->
                    <div id="certificate-area" class="hidden w-full">


                        <div class="cert-preview-container">
                            <div id="printable-area" class="certificate-container">
                                <div class="border-outer">
                                    <div class="border-inner">
                                        <!-- 4 Góc trang trí -->
                                        <div class="corner top-left"></div>
                                        <div class="corner top-right"></div>
                                        <div class="corner bottom-left"></div>
                                        <div class="corner bottom-right"></div>

                                        <!-- Quốc hiệu & Tiêu ngữ -->
                                        <div class="header-text">
                                            <div class="nation">Cộng hòa Xã hội Chủ nghĩa Việt Nam</div>
                                            <div class="motto">Độc lập - Tự do - Hạnh phúc</div>
                                        </div>

                                        <!-- Logo trang trí -->
                                        <div class="logo-placeholder">
                                            <svg width="40" height="40" viewBox="0 0 24 24" fill="#d4af37">
                                                <path
                                                    d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                                            </svg>
                                        </div>

                                        <!-- Tiêu đề -->
                                        <h1 class="title">GIẤY KHEN</h1>
                                        <div class="subtitle">Trân trọng trao tặng cho em</div>

                                        <!-- Nội dung -->
                                        <div class="content-body">
                                            <div id="cert-name" class="recipient-name" contenteditable="false">Nguyễn
                                                Thị
                                                Demo</div>
                                            <div class="recipient-class" contenteditable="false">Lớp: 12A</div>
                                            <div class="award-for">Đã có thành tích:</div>
                                            <div class="award-reason" contenteditable="false">Hoàn thành xuất sắc bài
                                                luyện tập Toán</div>
                                        </div>

                                        <!-- Footer -->
                                        <div class="footer">
                                            <div class="footer-right">
                                                <div id="cert-date" class="date-line" contenteditable="false">Đắk Lắk,
                                                    ngày ... tháng ... năm ...</div>
                                                <div class="signer-title">GIÁO VIÊN BỘ MÔN</div>
                                                <div class="signature-hand">Nguyên</div>
                                                <div class="signer-name" contenteditable="false">Nguyễn Đình Nguyên
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Badge A+ -->
                                        <div class="badge-left">
                                            <svg width="100%" height="100%" viewBox="0 0 120 120">
                                                <circle cx="60" cy="60" r="56" stroke="#d98d2b" stroke-width="4"
                                                    fill="#fffdf0" />
                                                <circle cx="60" cy="60" r="48" stroke="#d98d2b" stroke-width="1.5"
                                                    stroke-dasharray="3,2" fill="none" />
                                                <text x="60" y="62" font-family="'Roboto Slab', serif"
                                                    font-weight="bold" font-size="38" fill="#c47815"
                                                    text-anchor="middle" dominant-baseline="middle">A+</text>
                                                <text x="60" y="38" font-family="Arial, sans-serif" font-weight="bold"
                                                    font-size="10" fill="#c47815" text-anchor="middle"
                                                    letter-spacing="1">CHỨNG NHẬN</text>
                                                <text x="60" y="86" font-family="Arial, sans-serif" font-weight="bold"
                                                    font-size="10" fill="#c47815" text-anchor="middle"
                                                    letter-spacing="1">XUẤT SẮC</text>
                                            </svg>
                                        </div>

                                        <!-- Con dấu -->
                                        <div class="stamp-placeholder">(Xác nhận)</div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Certificate HTML -->
                        </div>

                        <button id="download-cert-btn" onclick="app.downloadCertificate()"
                            class="w-full py-3 bg-gradient-to-r from-yellow-400 to-orange-500 text-white rounded-xl font-bold shadow-lg shadow-orange-200 hover:scale-[1.02] transition-transform flex items-center justify-center gap-2 mt-4">
                            <i class="fa-solid fa-download"></i> Tải Giấy Khen
                        </button>
                    </div>

                    <button onclick="quiz.retry()"
                        class="w-full py-3 bg-white border border-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-50 transition-colors">
                        <i class="fa-solid fa-rotate-left mr-2"></i> Làm lại
                    </button>
                    <button onclick="app.goHome()"
                        class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold shadow-lg shadow-indigo-200 transition-colors">
                        <i class="fa-solid fa-house mr-2"></i> Về màn hình chính
                    </button>
                </div>
        </section>


        <!-- 3b. EXAM SCREEN (New) -->
        <section id="screen-exam" class="hidden w-full max-w-4xl h-[90vh] flex flex-col relative">
            <!-- Sticky Header -->
            <div class="glass-panel rounded-2xl p-4 mb-4 flex justify-between items-center shadow-lg z-20">
                <div class="flex items-center gap-3">
                    <div
                        class="w-10 h-10 rounded-full bg-red-100 text-red-600 flex items-center justify-center text-xl animate-pulse">
                        <i class="fa-regular fa-clock"></i>
                    </div>
                    <div>
                        <div class="text-xs font-bold text-slate-400 uppercase tracking-widest">Thời gian còn lại</div>
                        <div class="text-2xl font-display font-bold text-slate-800" id="exam-timer">15:00</div>
                    </div>
                </div>
                <button onclick="examManager.submit()"
                    class="px-6 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold shadow-lg shadow-indigo-200 transition-colors">
                    <i class="fa-solid fa-paper-plane mr-2"></i> Nộp bài
                </button>
            </div>

            <!-- Scrollable Questions List -->
            <div class="flex-grow overflow-y-auto pr-2" id="exam-questions-list">
                <!-- Questions injected here -->
            </div>
        </section>

    </main>

    <!-- MODALS -->

    <!-- 1. Settings (API Key) -->
    <div id="modal-settings"
        class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div
            class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md transform scale-95 transition-transform duration-300">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-display text-xl font-bold text-slate-800">Cài đặt</h3>
                <button onclick="app.closeModals()" class="text-slate-400 hover:text-slate-600 transition-colors"><i
                        class="fa-solid fa-xmark text-xl"></i></button>
            </div>

            <div class="mb-6">
                <label class="block text-sm font-bold text-slate-700 mb-2">Google Gemini API Key</label>
                <div class="relative">
                    <input type="password" id="input-api-key"
                        class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-sm transition-all"
                        placeholder="Nhập API Key của bạn...">
                    <div class="absolute left-3 top-3.5 text-slate-400"><i class="fa-solid fa-key"></i></div>
                </div>
                <p class="mt-2 text-xs text-slate-500">Key của bạn được lưu trong trình duyệt (LocalStorage) và không
                    được gửi đi đâu khác.</p>
                <a href="https://aistudio.google.com/app/apikey" target="_blank"
                    class="inline-block mt-2 text-xs text-indigo-600 hover:underline font-semibold">
                    Lấy API Key miễn phí <i class="fa-solid fa-external-link-alt ml-1"></i>
                </a>
            </div>

            <div class="flex justify-end">
                <button onclick="authManager.saveKey()"
                    class="px-6 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold text-sm shadow-lg shadow-indigo-200 transition-colors">Lưu
                    thay đổi</button>
            </div>
        </div>
    </div>

    <!-- 2. Leaderboard -->
    <div id="modal-leaderboard"
        class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div
            class="bg-white rounded-2xl shadow-2xl p-0 w-full max-w-md transform scale-95 transition-transform duration-300 overflow-hidden flex flex-col max-h-[80vh]">
            <div
                class="p-6 bg-gradient-to-r from-amber-400 to-orange-500 text-white flex justify-between items-center shrink-0">
                <h3 class="font-display text-xl font-bold"><i class="fa-solid fa-crown mr-2"></i>Bảng vàng</h3>
                <button onclick="app.closeModals()" class="text-white/80 hover:text-white transition-colors"><i
                        class="fa-solid fa-xmark text-xl"></i></button>
            </div>

            <div class="p-0 overflow-y-auto flex-grow" id="leaderboard-content">
                <!-- Injected via JS -->
                <div class="flex flex-col items-center justify-center h-40 text-slate-400">
                    <i class="fa-solid fa-spinner fa-spin text-2xl mb-2"></i>
                    <span class="text-sm">Đang tải dữ liệu...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. Loading Overlay -->
    <div id="loading-overlay"
        class="hidden fixed inset-0 z-[200] bg-white/90 backdrop-blur-md flex flex-col items-center justify-center transition-opacity duration-300">
        <div class="relative w-20 h-20 mb-6">
            <div class="absolute inset-0 border-4 border-indigo-100 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-indigo-600 rounded-full border-t-transparent animate-spin">
            </div>
            <div class="absolute inset-0 flex items-center justify-center text-indigo-600 text-xl font-bold">AI</div>
        </div>
        <h3 class="font-display text-xl font-bold text-slate-800 mb-2">Đang khởi tạo đề thi</h3>
        <p id="loading-text" class="text-slate-500 text-sm animate-pulse">Đang phân tích dữ liệu...</p>
    </div>

    <!-- 3.5 Level Selection Modal -->
    <div id="modal-level-select"
        class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div
            class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm transform scale-95 transition-transform duration-300 text-center">
            <h3 class="font-display text-xl font-bold text-slate-800 mb-2">Chọn độ khó</h3>
            <p class="text-slate-500 text-sm mb-6">Bạn muốn thử sức ở mức độ nào?</p>

            <div class="space-y-3">
                <button onclick="app.startTopicWithLevel('basic')"
                    class="w-full py-3 bg-emerald-50 hover:bg-emerald-100 border border-emerald-200 text-emerald-700 rounded-xl font-bold transition-all flex items-center justify-center gap-2">
                    <i class="fa-solid fa-leaf"></i> Cơ bản
                </button>
                <button onclick="app.startTopicWithLevel('advanced')"
                    class="w-full py-3 bg-rose-50 hover:bg-rose-100 border border-rose-200 text-rose-700 rounded-xl font-bold transition-all flex items-center justify-center gap-2">
                    <i class="fa-solid fa-fire"></i> Nâng cao
                </button>
                <button onclick="app.startTopicWithLevel('all')"
                    class="w-full py-3 bg-indigo-50 hover:bg-indigo-100 border border-indigo-200 text-indigo-700 rounded-xl font-bold transition-all flex items-center justify-center gap-2">
                    <i class="fa-solid fa-layer-group"></i> Hỗn hợp (Tất cả)
                </button>
            </div>
            <button onclick="app.closeModals()" class="mt-4 text-xs text-slate-400 hover:text-slate-600 font-medium">
                Hủy bỏ
            </button>
        </div>
    </div>

    <!-- 4. Profile & Stats Modal -->
    <div id="modal-profile"
        class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/40 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div
            class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl transform scale-95 transition-transform duration-300 overflow-hidden flex flex-col max-h-[90vh]">
            <div
                class="p-6 bg-gradient-to-r from-rose-500 to-pink-600 text-white flex justify-between items-start shrink-0">
                <div>
                    <h3 class="font-display text-2xl font-bold mb-1">Hồ sơ học tập</h3>
                    <p class="text-white/80 text-sm" id="profile-name">Học viên</p>
                </div>
                <button onclick="app.closeModals()" class="text-white/80 hover:text-white transition-colors"><i
                        class="fa-solid fa-xmark text-xl"></i></button>
            </div>

            <div class="p-6 overflow-y-auto">
                <!-- Stats Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-rose-50 rounded-2xl p-4 text-center">
                        <div class="text-rose-500 text-xl mb-1"><i class="fa-solid fa-fire"></i></div>
                        <div class="font-display font-bold text-2xl text-slate-800" id="stat-streak">0</div>
                        <div class="text-xs text-slate-500 uppercase font-bold">Streak ngày</div>
                    </div>
                    <div class="bg-indigo-50 rounded-2xl p-4 text-center">
                        <div class="text-indigo-500 text-xl mb-1"><i class="fa-solid fa-check-double"></i></div>
                        <div class="font-display font-bold text-2xl text-slate-800" id="stat-accuracy">0%</div>
                        <div class="text-xs text-slate-500 uppercase font-bold">Chính xác</div>
                    </div>
                    <div class="bg-emerald-50 rounded-2xl p-4 text-center">
                        <div class="text-emerald-500 text-xl mb-1"><i class="fa-solid fa-star"></i></div>
                        <div class="font-display font-bold text-2xl text-slate-800" id="stat-xp">0</div>
                        <div class="text-xs text-slate-500 uppercase font-bold">Điểm XP</div>
                    </div>
                    <div class="bg-amber-50 rounded-2xl p-4 text-center">
                        <div class="text-amber-500 text-xl mb-1"><i class="fa-solid fa-scroll"></i></div>
                        <div class="font-display font-bold text-2xl text-slate-800" id="stat-total">0</div>
                        <div class="text-xs text-slate-500 uppercase font-bold">Bài đã làm</div>
                    </div>
                </div>

                <!-- Chart -->
                <div class="mb-6">
                    <h4 class="font-bold text-slate-800 mb-4"><i
                            class="fa-solid fa-chart-line mr-2 text-indigo-600"></i>Tiến độ 7 ngày qua</h4>
                    <div class="h-64 w-full">
                        <canvas id="chart-history"></canvas>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div>
                    <h4 class="font-bold text-slate-800 mb-4"><i
                            class="fa-solid fa-clock-rotate-left mr-2 text-slate-600"></i>Gần đây</h4>
                    <div id="recent-list" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 5. AI Tutor Modal -->
    <div id="modal-tutor"
        class="hidden fixed bottom-4 right-4 z-[100] w-full max-w-md p-0 opacity-0 transition-opacity duration-300 pointer-events-none">
        <div
            class="bg-white rounded-2xl shadow-2xl w-full h-[500px] flex flex-col transform scale-95 transition-transform duration-300 overflow-hidden pointer-events-auto border border-slate-200">
            <!-- Header -->
            <div
                class="p-4 bg-gradient-to-r from-violet-600 to-indigo-600 text-white flex justify-between items-center shrink-0 shadow-md z-10">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center backdrop-blur-sm">
                        <i class="fa-solid fa-robot"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-sm">Gia sư AI</h3>
                        <div class="flex items-center gap-1">
                            <span class="w-2 h-2 rounded-full bg-green-400"></span>
                            <span class="text-[10px] text-white/80">Trực tuyến</span>
                        </div>
                    </div>
                </div>
                <button onclick="app.closeModals()" class="text-white/80 hover:text-white transition-colors"><i
                        class="fa-solid fa-xmark text-lg"></i></button>
            </div>

            <!-- Chat Area -->
            <div id="chat-messages" class="flex-grow overflow-y-auto p-4 space-y-3 bg-slate-50 relative">
                <!-- Messages injected here -->
                <div class="text-xs text-slate-400 text-center my-4">Hãy hỏi bất kỳ điều gì về bài toán này...</div>
            </div>

            <!-- Input Area -->
            <div class="p-3 bg-white border-t border-slate-100 shrink-0">
                <form onsubmit="aiTutor.send(event)" class="relative">
                    <input type="text" id="chat-input"
                        class="w-full pl-4 pr-12 py-3 bg-slate-100 border-0 rounded-xl focus:ring-2 focus:ring-violet-500 outline-none text-sm transition-all"
                        placeholder="Nhập câu hỏi của bạn..." autocomplete="off">
                    <button type="submit"
                        class="absolute right-2 top-2 w-8 h-8 bg-violet-600 text-white rounded-lg flex items-center justify-center hover:bg-violet-700 transition-colors shadow-md">
                        <i class="fa-solid fa-paper-plane text-xs"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Hidden Certificate Render Area (for html2canvas) -->
    <div id="certificate-render-area" class="fixed -z-50 pointer-events-none"
        style="width: 1122px; height: 794px; left: -15000px; top: 0; background-color: #555;">
        <!-- Certificate HTML will be injected here by CertificateGenerator -->
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script src="js/utils/certificate-generator.js"></script>
    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
</body>

</html>